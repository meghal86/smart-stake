<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Account Wallet Support Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #0A0F1F;
            color: white;
        }
        .test-section {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: rgba(34, 197, 94, 0.2); border: 1px solid #22c55e; }
        .error { background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; }
        .warning { background: rgba(245, 158, 11, 0.2); border: 1px solid #f59e0b; }
        .info { background: rgba(59, 130, 246, 0.2); border: 1px solid #3b82f6; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #2563eb; }
        button:disabled { background: #6b7280; cursor: not-allowed; }
        .wallet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .wallet-card {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .wallet-address {
            font-family: monospace;
            font-size: 12px;
            color: #06b6d4;
            word-break: break-all;
        }
        .wallet-label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .wallet-chain {
            font-size: 12px;
            color: #94a3b8;
        }
        .account-selector {
            background: rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        .account-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            margin: 5px 0;
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
            cursor: pointer;
        }
        .account-item:hover {
            background: rgba(255,255,255,0.1);
        }
        .account-item.selected {
            background: rgba(6, 182, 212, 0.2);
            border: 1px solid #06b6d4;
        }
        .checkbox {
            width: 16px;
            height: 16px;
            border: 1px solid #94a3b8;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .checkbox.checked {
            background: #06b6d4;
            border-color: #06b6d4;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .provider-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .provider-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .provider-card:hover {
            background: rgba(255,255,255,0.1);
            border-color: #06b6d4;
        }
        .provider-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <h1>üîó Multi-Account Wallet Support Test</h1>
    <p>This test demonstrates the ability to add multiple accounts from the same wallet provider.</p>

    <div class="test-section">
        <h2>1. Wallet Provider Selection</h2>
        <p>Choose a wallet provider to add multiple accounts from:</p>
        
        <div class="provider-grid">
            <div class="provider-card" onclick="selectProvider('metamask')">
                <div class="provider-icon">ü¶ä</div>
                <div><strong>MetaMask</strong></div>
                <div style="font-size: 12px; color: #94a3b8;">Add multiple MetaMask accounts</div>
            </div>
            <div class="provider-card" onclick="selectProvider('base')">
                <div class="provider-icon">üîµ</div>
                <div><strong>Base Wallet</strong></div>
                <div style="font-size: 12px; color: #94a3b8;">Add multiple Base accounts</div>
            </div>
            <div class="provider-card" onclick="selectProvider('rainbow')">
                <div class="provider-icon">üåà</div>
                <div><strong>Rainbow</strong></div>
                <div style="font-size: 12px; color: #94a3b8;">Add multiple Rainbow accounts</div>
            </div>
            <div class="provider-card" onclick="selectProvider('coinbase')">
                <div class="provider-icon">üî∑</div>
                <div><strong>Coinbase Wallet</strong></div>
                <div style="font-size: 12px; color: #94a3b8;">Add multiple Coinbase accounts</div>
            </div>
        </div>
        
        <div id="provider-status"></div>
    </div>

    <div class="test-section" id="account-selection" style="display: none;">
        <h2>2. Account Selection</h2>
        <p>Select the accounts you want to add from <span id="selected-provider"></span>:</p>
        
        <div class="account-selector">
            <div id="accounts-list"></div>
            
            <div style="margin-top: 15px;">
                <button onclick="addSelectedAccounts()" id="add-accounts-btn" disabled>
                    Add Selected Accounts
                </button>
                <button onclick="cancelSelection()">Cancel</button>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>3. Manual Wallet Addition</h2>
        <p>Add any wallet address for watch-only monitoring:</p>
        
        <div style="display: flex; gap: 10px; align-items: end; margin: 15px 0;">
            <div style="flex: 1;">
                <label style="display: block; margin-bottom: 5px;">Wallet Address:</label>
                <input 
                    type="text" 
                    id="manual-address" 
                    placeholder="0x... or name.eth"
                    style="width: 100%; padding: 8px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; color: white;"
                >
            </div>
            <div style="flex: 1;">
                <label style="display: block; margin-bottom: 5px;">Label (Optional):</label>
                <input 
                    type="text" 
                    id="manual-label" 
                    placeholder="My DeFi Wallet"
                    style="width: 100%; padding: 8px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; color: white;"
                >
            </div>
            <button onclick="addManualWallet()">Add Watch-Only</button>
        </div>
        
        <div id="manual-status"></div>
    </div>

    <div class="test-section">
        <h2>4. Connected Wallets</h2>
        <div id="wallets-display" class="wallet-grid"></div>
        <button onclick="refreshWallets()">Refresh Wallets</button>
    </div>

    <div class="test-section">
        <h2>Console Log</h2>
        <div id="console-log" class="log"></div>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <script>
        let logElement = document.getElementById('console-log');
        let selectedProvider = null;
        let availableAccounts = [];
        let selectedAccounts = new Set();
        let connectedWallets = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}\n`;
            logElement.textContent += logMessage;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            logElement.textContent = '';
        }

        function setStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        async function selectProvider(providerId) {
            selectedProvider = providerId;
            const providerNames = {
                'metamask': 'MetaMask',
                'base': 'Base Wallet',
                'rainbow': 'Rainbow',
                'coinbase': 'Coinbase Wallet'
            };
            
            log(`Selected provider: ${providerNames[providerId]}`);
            setStatus('provider-status', `Selected: ${providerNames[providerId]}`, 'info');
            
            document.getElementById('selected-provider').textContent = providerNames[providerId];
            
            // Simulate fetching accounts
            await fetchAccountsFromProvider(providerId);
        }

        async function fetchAccountsFromProvider(providerId) {
            log('Fetching accounts from wallet...');
            
            try {
                // Simulate multiple accounts from the same provider
                const mockAccounts = [
                    {
                        address: '0x1234567890abcdef1234567890abcdef12345678',
                        balance: '1.234 ETH',
                        isAlreadyAdded: false
                    },
                    {
                        address: '0xabcdef1234567890abcdef1234567890abcdef12',
                        balance: '0.567 ETH',
                        isAlreadyAdded: false
                    },
                    {
                        address: '0x9876543210fedcba9876543210fedcba98765432',
                        balance: '2.891 ETH',
                        isAlreadyAdded: true // This one is already added
                    },
                    {
                        address: '0xfedcba0987654321fedcba0987654321fedcba09',
                        balance: '0.123 ETH',
                        isAlreadyAdded: false
                    }
                ];
                
                availableAccounts = mockAccounts;
                displayAccounts();
                
                document.getElementById('account-selection').style.display = 'block';
                log(`‚úÖ Found ${mockAccounts.length} accounts`);
                
            } catch (error) {
                log(`‚ùå Failed to fetch accounts: ${error.message}`);
                setStatus('provider-status', `Failed to fetch accounts: ${error.message}`, 'error');
            }
        }

        function displayAccounts() {
            const accountsList = document.getElementById('accounts-list');
            const providerNames = {
                'metamask': 'MetaMask',
                'base': 'Base',
                'rainbow': 'Rainbow',
                'coinbase': 'Coinbase'
            };
            
            accountsList.innerHTML = availableAccounts.map((account, index) => `
                <div class="account-item ${selectedAccounts.has(account.address) ? 'selected' : ''}" 
                     onclick="toggleAccount('${account.address}')"
                     ${account.isAlreadyAdded ? 'style="opacity: 0.6;"' : ''}>
                    <div class="checkbox ${selectedAccounts.has(account.address) ? 'checked' : ''}">
                        ${selectedAccounts.has(account.address) ? '‚úì' : ''}
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: bold;">${providerNames[selectedProvider]} Account ${index + 1}</div>
                        <div class="wallet-address">${account.address}</div>
                        <div style="font-size: 12px; color: #94a3b8;">${account.balance}</div>
                    </div>
                    ${account.isAlreadyAdded ? '<div style="color: #22c55e; font-size: 12px;">‚úì Already Added</div>' : ''}
                </div>
            `).join('');
            
            updateAddButton();
        }

        function toggleAccount(address) {
            const account = availableAccounts.find(acc => acc.address === address);
            if (account.isAlreadyAdded) return; // Can't select already added accounts
            
            if (selectedAccounts.has(address)) {
                selectedAccounts.delete(address);
            } else {
                selectedAccounts.add(address);
            }
            
            displayAccounts();
            log(`${selectedAccounts.has(address) ? 'Selected' : 'Deselected'} account: ${address.slice(0, 10)}...`);
        }

        function updateAddButton() {
            const button = document.getElementById('add-accounts-btn');
            const count = selectedAccounts.size;
            
            if (count === 0) {
                button.disabled = true;
                button.textContent = 'Add Selected Accounts';
            } else {
                button.disabled = false;
                button.textContent = `Add ${count} Account${count !== 1 ? 's' : ''}`;
            }
        }

        async function addSelectedAccounts() {
            if (selectedAccounts.size === 0) return;
            
            const accountsToAdd = Array.from(selectedAccounts);
            log(`Adding ${accountsToAdd.length} accounts...`);
            
            try {
                const providerNames = {
                    'metamask': 'MetaMask',
                    'base': 'Base',
                    'rainbow': 'Rainbow',
                    'coinbase': 'Coinbase'
                };
                
                for (let i = 0; i < accountsToAdd.length; i++) {
                    const address = accountsToAdd[i];
                    const accountIndex = availableAccounts.findIndex(acc => acc.address === address);
                    
                    const wallet = {
                        id: Date.now() + i,
                        address: address,
                        label: `${providerNames[selectedProvider]} Account ${accountIndex + 1}`,
                        chain_namespace: 'eip155:1',
                        created_at: new Date().toISOString()
                    };
                    
                    connectedWallets.push(wallet);
                    log(`‚úÖ Added: ${wallet.label} (${address.slice(0, 10)}...)`);
                }
                
                setStatus('provider-status', `‚úÖ Successfully added ${accountsToAdd.length} accounts!`, 'success');
                
                // Reset selection
                selectedAccounts.clear();
                document.getElementById('account-selection').style.display = 'none';
                
                refreshWallets();
                
            } catch (error) {
                log(`‚ùå Failed to add accounts: ${error.message}`);
                setStatus('provider-status', `Failed to add accounts: ${error.message}`, 'error');
            }
        }

        function cancelSelection() {
            selectedAccounts.clear();
            document.getElementById('account-selection').style.display = 'none';
            setStatus('provider-status', 'Selection cancelled', 'warning');
        }

        async function addManualWallet() {
            const address = document.getElementById('manual-address').value.trim();
            const label = document.getElementById('manual-label').value.trim();
            
            if (!address) {
                setStatus('manual-status', 'Please enter a wallet address', 'error');
                return;
            }
            
            // Basic validation
            if (!address.startsWith('0x') && !address.endsWith('.eth') && !address.endsWith('.lens')) {
                setStatus('manual-status', 'Invalid address format', 'error');
                return;
            }
            
            log(`Adding manual wallet: ${address}`);
            
            try {
                const wallet = {
                    id: Date.now(),
                    address: address,
                    label: label || 'Watch-only Wallet',
                    chain_namespace: 'eip155:1',
                    created_at: new Date().toISOString(),
                    isWatchOnly: true
                };
                
                connectedWallets.push(wallet);
                
                setStatus('manual-status', '‚úÖ Watch-only wallet added successfully!', 'success');
                log(`‚úÖ Added watch-only wallet: ${wallet.label} (${address})`);
                
                // Clear form
                document.getElementById('manual-address').value = '';
                document.getElementById('manual-label').value = '';
                
                refreshWallets();
                
            } catch (error) {
                log(`‚ùå Failed to add manual wallet: ${error.message}`);
                setStatus('manual-status', `Failed to add wallet: ${error.message}`, 'error');
            }
        }

        function refreshWallets() {
            const walletsDisplay = document.getElementById('wallets-display');
            
            if (connectedWallets.length === 0) {
                walletsDisplay.innerHTML = '<div style="text-align: center; color: #94a3b8; padding: 20px;">No wallets connected</div>';
                return;
            }
            
            walletsDisplay.innerHTML = connectedWallets.map(wallet => `
                <div class="wallet-card">
                    <div class="wallet-label">
                        ${wallet.label}
                        ${wallet.isWatchOnly ? '<span style="color: #06b6d4; font-size: 12px; margin-left: 8px;">üëÅÔ∏è Watch-Only</span>' : ''}
                    </div>
                    <div class="wallet-address">${wallet.address}</div>
                    <div class="wallet-chain">${wallet.chain_namespace}</div>
                    <div style="font-size: 12px; color: #94a3b8; margin-top: 5px;">
                        Added: ${new Date(wallet.created_at).toLocaleString()}
                    </div>
                </div>
            `).join('');
            
            log(`Displaying ${connectedWallets.length} connected wallets`);
        }

        // Initialize
        log('üîó Multi-Account Wallet Support Test initialized');
        log('Select a wallet provider to add multiple accounts');
        refreshWallets();
    </script>
</body>
</html>