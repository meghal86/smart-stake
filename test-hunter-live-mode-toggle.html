<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hunter Live Mode Toggle Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background: #0A0F1F;
      color: #E4E8F3;
    }
    .test-section {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .test-section h2 {
      margin-top: 0;
      color: #00F5A0;
    }
    .status {
      display: inline-block;
      padding: 6px 16px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 14px;
      margin: 8px 8px 8px 0;
    }
    .status.pass {
      background: rgba(0, 245, 160, 0.2);
      color: #00F5A0;
    }
    .status.fail {
      background: rgba(239, 68, 68, 0.2);
      color: #EF4444;
    }
    .status.pending {
      background: rgba(251, 191, 36, 0.2);
      color: #FBBF24;
    }
    pre {
      background: rgba(0,0,0,0.3);
      padding: 12px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 13px;
      line-height: 1.5;
    }
    .test-result {
      margin: 12px 0;
      padding: 12px;
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
    }
    button {
      background: linear-gradient(135deg, #00F5A0, #7B61FF);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      font-size: 14px;
      margin: 8px 8px 8px 0;
    }
    button:hover {
      transform: scale(1.02);
    }
    .code-inline {
      background: rgba(0,0,0,0.3);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }
    .warning {
      background: rgba(251, 191, 36, 0.1);
      border-left: 4px solid #FBBF24;
      padding: 12px;
      margin: 12px 0;
      border-radius: 4px;
    }
    .success {
      background: rgba(0, 245, 160, 0.1);
      border-left: 4px solid #00F5A0;
      padding: 12px;
      margin: 12px 0;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h1>üéØ Hunter Live Mode Toggle Test</h1>
  
  <div class="test-section">
    <h2>Test Overview</h2>
    <p>This test verifies that the React Query key fix allows proper mode switching.</p>
    
    <div class="warning">
      <strong>‚ö†Ô∏è Important:</strong> This is a simulation. The actual fix is in <code class="code-inline">src/hooks/useHunterFeed.ts</code>
    </div>
  </div>

  <div class="test-section">
    <h2>Test 1: Query Key Structure</h2>
    <div id="test1"></div>
  </div>

  <div class="test-section">
    <h2>Test 2: Mode Switching Behavior</h2>
    <div id="test2"></div>
  </div>

  <div class="test-section">
    <h2>Test 3: Expected Console Output</h2>
    <div id="test3"></div>
  </div>

  <div class="test-section">
    <h2>Manual Testing Instructions</h2>
    <div class="success">
      <strong>‚úÖ To test in your app:</strong>
      <ol style="margin: 12px 0; padding-left: 20px;">
        <li>Hard refresh browser: <code class="code-inline">Ctrl+Shift+R</code> or <code class="code-inline">Cmd+Shift+R</code></li>
        <li>Navigate to <code class="code-inline">/hunter</code></li>
        <li>Open browser console (F12)</li>
        <li>Connect wallet</li>
        <li>Toggle demo mode switch</li>
        <li>Watch console logs for mode changes</li>
        <li>Check Network tab for API calls</li>
      </ol>
    </div>
  </div>

  <script>
    // Test 1: Query Key Structure
    function test1() {
      const container = document.getElementById('test1');
      
      const activeWallet = '0x353394b8fe89e9d52ba5c3d463b863f82c383330';
      const activeNetwork = 'eip155:1';
      
      // OLD query key (without isDemo)
      const oldKey = ['hunter', 'feed', activeWallet, activeNetwork];
      
      // NEW query key (with isDemo)
      const newKeyDemo = ['hunter', 'feed', activeWallet, activeNetwork, true];
      const newKeyLive = ['hunter', 'feed', activeWallet, activeNetwork, false];
      
      container.innerHTML = `
        <div class="test-result">
          <h3>‚ùå OLD Query Key (Broken)</h3>
          <pre>${JSON.stringify(oldKey, null, 2)}</pre>
          <p><strong>Problem:</strong> When you toggle demo mode, the key stays the same, so React Query doesn't refetch.</p>
        </div>
        
        <div class="test-result">
          <h3>‚úÖ NEW Query Key (Fixed)</h3>
          <p><strong>Demo Mode:</strong></p>
          <pre>${JSON.stringify(newKeyDemo, null, 2)}</pre>
          <p><strong>Live Mode:</strong></p>
          <pre>${JSON.stringify(newKeyLive, null, 2)}</pre>
          <p><strong>Solution:</strong> The key changes when you toggle, triggering a refetch!</p>
        </div>
        
        <div class="test-result">
          <span class="status pass">‚úÖ PASS</span>
          <p>Query key now includes <code class="code-inline">isDemo</code> parameter</p>
        </div>
      `;
    }

    // Test 2: Mode Switching Behavior
    function test2() {
      const container = document.getElementById('test2');
      
      let currentMode = 'demo';
      let fetchCount = 0;
      
      const scenarios = [
        { action: 'Initial load', mode: 'demo', shouldFetch: true, reason: 'First load always fetches' },
        { action: 'Toggle to live', mode: 'live', shouldFetch: true, reason: 'Key changed (demo ‚Üí live)' },
        { action: 'Toggle to demo', mode: 'demo', shouldFetch: true, reason: 'Key changed (live ‚Üí demo)' },
        { action: 'Toggle to live', mode: 'live', shouldFetch: true, reason: 'Key changed (demo ‚Üí live)' },
        { action: 'Stay in live', mode: 'live', shouldFetch: false, reason: 'Key unchanged' },
      ];
      
      let html = '<div class="test-result">';
      html += '<h3>Mode Switching Simulation</h3>';
      html += '<table style="width: 100%; border-collapse: collapse;">';
      html += '<tr style="border-bottom: 1px solid rgba(255,255,255,0.1);"><th style="text-align: left; padding: 8px;">Action</th><th style="text-align: left; padding: 8px;">Mode</th><th style="text-align: left; padding: 8px;">Refetch?</th><th style="text-align: left; padding: 8px;">Reason</th></tr>';
      
      scenarios.forEach((scenario, i) => {
        const icon = scenario.shouldFetch ? 'üîÑ' : 'üí§';
        html += `<tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">`;
        html += `<td style="padding: 8px;">${i + 1}. ${scenario.action}</td>`;
        html += `<td style="padding: 8px;"><code class="code-inline">${scenario.mode}</code></td>`;
        html += `<td style="padding: 8px;">${icon} ${scenario.shouldFetch ? 'Yes' : 'No'}</td>`;
        html += `<td style="padding: 8px; color: #888;">${scenario.reason}</td>`;
        html += `</tr>`;
      });
      
      html += '</table>';
      html += '</div>';
      
      html += '<div class="test-result">';
      html += '<span class="status pass">‚úÖ PASS</span>';
      html += '<p>Mode switching triggers refetch correctly</p>';
      html += '</div>';
      
      container.innerHTML = html;
    }

    // Test 3: Expected Console Output
    function test3() {
      const container = document.getElementById('test3');
      
      const demoOutput = `üéØ Hunter Feed Mode: {
  isDemo: true,
  useRealAPI: false,
  activeWallet: null,
  filter: "All",
  timestamp: "2026-01-20T00:10:34.618Z"
}
üé≠ DEMO MODE ACTIVE - Using mock data
üì¶ Demo Mode: Returning mock data (5 opportunities)`;

      const liveOutput = `üéØ Hunter Feed Mode: {
  isDemo: false,
  useRealAPI: true,
  activeWallet: "0x353394b8fe89e9d52ba5c3d463b863f82c383330",
  filter: "All",
  timestamp: "2026-01-20T00:10:45.123Z"
}
üî¥ LIVE MODE ACTIVE - Will fetch from API
üåê Live Mode: Fetching from API {
  endpoint: "/api/hunter/opportunities",
  params: {
    types: undefined,
    sort: "recommended",
    trustMin: 80,
    showRisky: false,
    limit: 12,
    walletAddress: "0x353394b8fe89e9d52ba5c3d463b863f82c383330",
    cursor: undefined
  }
}`;

      const errorOutput = `‚ùå Error: relation "mv_opportunity_rank" does not exist
‚ö†Ô∏è This means the database table hasn't been created yet`;

      container.innerHTML = `
        <div class="test-result">
          <h3>Demo Mode Console Output</h3>
          <pre>${demoOutput}</pre>
        </div>
        
        <div class="test-result">
          <h3>Live Mode Console Output (Success)</h3>
          <pre>${liveOutput}</pre>
          <p style="color: #00F5A0;">‚úÖ If you see this, the API call is being made!</p>
        </div>
        
        <div class="test-result">
          <h3>Live Mode Console Output (Database Missing)</h3>
          <pre>${errorOutput}</pre>
          <p style="color: #FBBF24;">‚ö†Ô∏è If you see this, the database schema needs to be created</p>
        </div>
      `;
    }

    // Run all tests
    test1();
    test2();
    test3();
  </script>

  <div class="test-section">
    <h2>üìã Summary</h2>
    <div class="success">
      <h3>‚úÖ What Was Fixed</h3>
      <ul style="margin: 8px 0; padding-left: 20px;">
        <li>Query key now includes <code class="code-inline">isDemo</code> parameter</li>
        <li>Mode switching triggers React Query refetch</li>
        <li>Enhanced console logging for debugging</li>
      </ul>
    </div>
    
    <div class="warning">
      <h3>‚ö†Ô∏è Known Issue</h3>
      <p>The <code class="code-inline">mv_opportunity_rank</code> database table doesn't exist yet. You'll see API calls being made, but they'll fail until the database schema is created.</p>
      <p><strong>Temporary Solution:</strong> Keep demo mode ON until database is set up.</p>
    </div>
    
    <div class="test-result">
      <h3>üéØ Next Steps</h3>
      <ol style="margin: 8px 0; padding-left: 20px;">
        <li>Hard refresh browser to load the fix</li>
        <li>Toggle demo mode and watch console</li>
        <li>Verify mode switching works</li>
        <li>Create database schema (see <code class="code-inline">HUNTER_LIVE_MODE_NOT_WORKING_FIX.md</code>)</li>
      </ol>
    </div>
  </div>
</body>
</html>
